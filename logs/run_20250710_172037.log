2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 日志系统初始化完成 - 目录: logs, 级别: INFO
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 开始电影推荐系统训练
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 保存实验配置到: experiments/LightGBM_CORAL_MovieLens_20250710_172037/config.json
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 创建实验: LightGBM_CORAL_MovieLens_20250710_172037
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 实验目录: experiments/LightGBM_CORAL_MovieLens_20250710_172037
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 数据加载和预处理
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 开始加载数据文件
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 加载评分数据: data/ratings.csv
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 生成时间相关特征
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 加载电影数据: data/movies.csv
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 加载标签数据: data/tags.csv
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 开始数据预处理和异常值检测
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 开始检测评分数据异常值
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 执行基本数据质量检查
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 检测评分范围异常
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 检测用户行为异常
2025-07-10 17:20:37 - MovieRecommender - WARNING - warning:168 - 发现 15 个异常行为用户
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 检测时间序列异常
2025-07-10 17:20:37 - MovieRecommender - WARNING - warning:168 - 发现 597 个时间行为异常用户
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 执行多维异常检测
2025-07-10 17:20:37 - MovieRecommender - WARNING - warning:168 - 发现 61 个多维异常用户
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 异常值检测完成:
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 总记录数: 100836
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 总异常值: 99928 (99.10%)
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - is_basic_outlier: 0 (0.0%)
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - is_range_outlier: 0 (0.0%)
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - is_behavior_outlier: 20489 (20.32%)
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - is_temporal_outlier: 96070 (95.27%)
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - is_multivariate_outlier: 40258 (39.92%)
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 使用策略 'flag' 处理异常值
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 数据预处理完成
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 数据加载完成:
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 -   评分记录数: 100,836
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 -   电影数量: 9,742
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 -   标签记录数: 3,683
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 -   用户数量: 610
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 -   评分范围: 0.5 - 5.0
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 -   时间范围: 1996-03-29 18:36:55 - 2018-09-24 14:27:30
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 记录指标: data_quality_score = 0
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 记录指标: outlier_count = 0
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 记录指标: outlier_ratio = 0
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 特征工程
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 开始创建协同过滤特征，隐因子维度: 20
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 构建用户-物品评分矩阵
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 评分矩阵: 610用户 x 9724物品, 100836评分
2025-07-10 17:20:37 - MovieRecommender - INFO - info:153 - 执行SVD分解
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - SVD分解完成
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 协同过滤特征创建完成:
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   用户隐因子: (610, 21)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   物品隐因子: (9724, 21)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   用户偏置: (610, 2)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   物品偏置: (9724, 2)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 开始创建电影内容特征
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 提取电影发行年份...
2025-07-10 17:20:38 - MovieRecommender - WARNING - warning:168 - 有13部电影缺少年份信息，将使用均值填充
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 标准化年份特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 处理电影类型特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 识别到20种电影类型: ['(no genres listed)', 'Action', 'Adventure', 'Animation', 'Children', 'Comedy', 'Crime', 'Documentary', 'Drama', 'Fantasy', 'Film-Noir', 'Horror', 'IMAX', 'Musical', 'Mystery', 'Romance', 'Sci-Fi', 'Thriller', 'War', 'Western']
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并内容特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 内容特征创建完成:
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   特征维度: (9742, 22)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   年份范围: -5.00 - 1.26 (标准化后)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   类型数量: 20
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 开始创建TF-IDF标签特征，目标维度: 100
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 聚合用户-电影标签文档...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 聚合后标签记录数: 1775，原始标签数: 3683
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并标签与评分数据...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 标签覆盖率: 1.6% (1635/100836)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 初始化TF-IDF向量化器...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 生成TF-IDF特征矩阵...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - TF-IDF矩阵形状: (100836, 100)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 词汇表大小: 100
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 转换为DataFrame格式...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - TF-IDF标签特征创建完成:
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   评分+标签数据: (100836, 15)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   TF-IDF特征: (100836, 100)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   平均非零特征数: 0.02
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 开始创建用户画像特征
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 计算用户评分统计特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 用户统计特征: (610, 4)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 平均评分范围: 1.27 - 5.00
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 平均评分数量: 165.3
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 计算用户类型偏好特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 用户类型偏好特征: (610, 952)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 识别类型数量: 951
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 用户画像特征创建完成:
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   统计特征: (610, 3)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 -   类型偏好特征: (610, 952)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 开始创建电影画像特征
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 计算电影评分统计特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 电影画像特征创建完成: (9724, 4)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 电影平均评分范围: 0.50 - 5.00
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 电影评分数量范围: 1 - 329
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 平均每部电影评分数: 10.4
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 开始合并所有特征
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 以评分+标签数据为基础...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 基础数据形状: (100836, 15)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并电影内容特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 36)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并用户隐因子特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 56)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并电影隐因子特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 76)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并用户偏置特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 77)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并电影偏置特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 78)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并用户统计特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 80)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并用户类型偏好特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 1031)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并电影统计特征...
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 1034)
2025-07-10 17:20:38 - MovieRecommender - INFO - info:153 - 合并TF-IDF标签特征...
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 合并后形状: (100836, 1134)
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 生成20个用户-物品交叉特征...
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 交叉特征生成完成: ['cross_f0', 'cross_f1', 'cross_f2', 'cross_f3', 'cross_f4', 'cross_f5', 'cross_f6', 'cross_f7', 'cross_f8', 'cross_f9', 'cross_f10', 'cross_f11', 'cross_f12', 'cross_f13', 'cross_f14', 'cross_f15', 'cross_f16', 'cross_f17', 'cross_f18', 'cross_f19']
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 特征合并完成:
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   最终数据形状: (100836, 1154)
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   新增特征数: 1139
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   总特征数: 1154
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   数据完整性: 100.0%
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 数据准备和划分
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 标签分布: {0: 1370, 1: 2811, 2: 1791, 3: 7551, 4: 5550, 5: 20047, 6: 13136, 7: 26818, 8: 8551, 9: 13211}
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 可用特征数量: 1141
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 特征类型分布:
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   - 电影类型特征: 20
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   - 用户偏好特征: 951
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   - 协同过滤特征: 60
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   - 标签特征: 100
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 使用Leave-5-out策略划分训练集和验证集
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 - 用户统计:
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   - 有验证集的用户: 610
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   - 无验证集的用户: 0
2025-07-10 17:20:39 - MovieRecommender - INFO - info:153 -   - 总用户数: 610
2025-07-10 17:20:40 - MovieRecommender - INFO - info:153 - 数据集大小:
2025-07-10 17:20:40 - MovieRecommender - INFO - info:153 -   - 训练集: 97,786 (97.0%)
2025-07-10 17:20:40 - MovieRecommender - INFO - info:153 -   - 验证集: 3,050 (3.0%)
2025-07-10 17:20:40 - MovieRecommender - INFO - info:153 - 模型训练
2025-07-10 17:20:40 - MovieRecommender - INFO - info:153 - 开始训练CORAL风格的LightGBM序数分类器
2025-07-10 17:20:40 - MovieRecommender - INFO - info:153 - 类别特征索引: [1, 2, 3]
2025-07-10 17:25:35 - MovieRecommender - INFO - info:153 - 训练完成，共训练9个二分类器
2025-07-10 17:25:35 - MovieRecommender - INFO - info:153 - 模型评估
2025-07-10 17:25:35 - MovieRecommender - INFO - info:153 - 进行模型预测
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 计算评估指标
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 验证集RMSE: 0.8166
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 记录指标: RMSE = 0.8165802340790063
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 记录指标: train_size = 97786
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 记录指标: val_size = 3050
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 记录指标: feature_count = 1141
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 记录指标: users_with_val = 610
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 记录指标: users_without_val = 0
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 保存预测结果
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 预测结果已保存至: output/predictions.csv
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 保存DataFrame到: experiments/LightGBM_CORAL_MovieLens_20250710_172037/data/predictions
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 预测结果统计:
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 -   - 平均绝对误差: 0.5454
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 -   - 误差标准差: 0.8155
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 -   - 完全正确预测比例: 40.39%
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 -   - 误差≤0.5的比例: 67.38%
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 可视化分析
2025-07-10 17:25:36 - MovieRecommender - INFO - info:153 - 生成基本预测效果图表
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 箱线图已保存到: output/boxplot_true_vs_pred.png
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 分析了 3050 个预测样本，涵盖 10 个评分等级
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 预测评分直方图已保存到: output/predicted_rating_hist.png
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 分析了 3050 个预测评分，范围: [0.50, 5.00]
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 基本预测效果图表生成完成
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 生成误差分析图表
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 检测到 51 个异常值 (1.7%)
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 误差分布图已保存到: output/prediction_error_hist.png
2025-07-10 17:25:37 - MovieRecommender - INFO - info:153 - 误差统计: 均值=0.0448, 标准差=0.8155, RMSE=0.8166
2025-07-10 17:25:38 - MovieRecommender - INFO - info:153 - 平均误差条形图已保存到: output/mean_error_per_rating.png
2025-07-10 17:25:38 - MovieRecommender - INFO - info:153 - 整体偏差: 0.5657
2025-07-10 17:25:38 - MovieRecommender - INFO - info:153 - 最大偏差评分等级: 0.5 (偏差: 1.9884)
2025-07-10 17:25:38 - MovieRecommender - INFO - info:153 - RMSE条形图已保存到: output/rmse_per_rating_level.png
2025-07-10 17:25:38 - MovieRecommender - INFO - info:153 - 总体RMSE: 0.8166, 总体MAE: 0.5454
2025-07-10 17:25:38 - MovieRecommender - INFO - info:153 - 混淆矩阵热力图已保存到: output/confusion_heatmap.png
2025-07-10 17:25:38 - MovieRecommender - INFO - info:153 - 总体准确率: 0.404, 分析了 3050 个样本
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 用户误差分布图已保存到: output/user_error_distribution.png
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 分析了 610 个用户的误差分布
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 误差分析图表生成完成
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 生成特征分析图表
2025-07-10 17:25:39 - MovieRecommender - ERROR - error:186 - 可视化生成过程中出现错误: X_train必须是pandas DataFrame类型
2025-07-10 17:25:39 - MovieRecommender - WARNING - warning:168 - 继续执行后续步骤...
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 实验总结
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 总执行时间: 301.35秒 (5.0分钟)
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 记录指标: execution_time = 301.3502736091614
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 保存实验结果到: experiments/LightGBM_CORAL_MovieLens_20250710_172037/results.json
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 实验完成！
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 最终RMSE: 0.8166
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 执行时间: 301.35秒
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 使用特征数: 1141
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 训练样本数: 97,786
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 验证样本数: 3,050
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 结果保存目录: output
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 实验记录ID: LightGBM_CORAL_MovieLens_20250710_172037
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 实验总结完成
2025-07-10 17:25:39 - MovieRecommender - INFO - info:153 - 保存实验结果到: experiments/LightGBM_CORAL_MovieLens_20250710_172037/results.json
